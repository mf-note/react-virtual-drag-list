!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList={},t.React)}(this,function(t,Q){"use strict";function e(n){if(n&&n.__esModule)return n;var i=Object.create(null);return n&&Object.keys(n).forEach(function(t){var e;"default"!==t&&(e=Object.getOwnPropertyDescriptor(n,t),Object.defineProperty(i,t,e.get?e:{enumerable:!0,get:function(){return n[t]}}))}),i.default=n,Object.freeze(i)}var Z=e(Q);function a(t){const{uniqueKey:e,children:n,onSizeChange:i}=t,o=Z.useRef(null);t="function"==typeof n?n(o):n;return Z.useLayoutEffect(()=>{let t;return t=new ResizeObserver(()=>{var t=o.current.clientHeight;i&&i(e,t)}),o.current&&t.observe(o.current),()=>{t&&(t.disconnect(),t=null)}},[o]),Z.cloneElement(t,{ref:o})}function tt(t){const{children:e,uniqueKey:n,itemClass:i,itemStyle:o}=t;var{record:t,index:r,onSizeChange:s}=t;return Z.createElement(a,{uniqueKey:n,onSizeChange:s},Z.createElement("div",{className:i,style:o,"data-key":n},"function"==typeof e?e(t,r,n):e))}function et(t){var{children:t,roleId:e,onSizeChange:n}=t;return t?Z.createElement(a,{uniqueKey:e,onSizeChange:n},Z.createElement("div",{"v-role":e},t)):Z.createElement(Z.Fragment,null)}function nt(n,i=50,o=!1){let r,s;function t(...t){var e;return r&&clearTimeout(r),o?(e=!r,r=setTimeout(()=>{r=null},i),e&&(s=n.apply(this,t))):r=setTimeout(()=>{n.apply(this,t)},i),s}return t.prototype.cancel=function(){clearTimeout(r),r=null},t}const l={INIT:"INIT",FIXED:"FIXED",DYNAMIC:"DYNAMIC"},n={FRONT:"FRONT",BEHIND:"BEHIND"};class i{average=void 0;total=void 0;fixed=void 0;header=void 0;footer=void 0}class o{start=0;end=0;front=0;behind=0}class it{options;callback;sizes;isHorizontal;calcIndex;calcType;calcSize;range;direction;offset;constructor(t,e){this.options=t,this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=l.INIT,this.calcSize=new i,this.direction="",this.offset=0,this.range=new o,t&&this.checkIfUpdate(0,t.keeps-1)}updateUniqueKeys(t){this.options.uniqueKeys=t}updateSizes(n){this.sizes.forEach((t,e)=>{n.includes(e)||this.sizes.delete(e)})}updateRange(){var t=Math.max(this.range.start,0);this.handleUpdate(t,this.getEndByStart(t))}handleScroll(t){this.direction=t<this.offset?n.FRONT:n.BEHIND,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)}isFront(){return this.direction===n.FRONT}isBehind(){return this.direction===n.BEHIND}getScrollItems(t){var{fixed:e,header:n}=this.calcSize;if(n&&(t-=n),t<=0)return 0;if(this.calcType===l.FIXED)return Math.floor(t/e);let i=0,o=this.options.uniqueKeys.length;for(var r,s;i<=o;){if(r=i+Math.floor((o-i)/2),(s=this.getOffsetByIndex(r))===t)return r;s<t?i=r+1:t<s&&(o=r-1)}return 0<i?--i:0}handleScrollFront(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))}handleScrollBehind(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))}checkIfUpdate(t,e){var{uniqueKeys:n,keeps:i}=this.options;n.length<=i?(t=0,e=n.length-1):e-t<i-1&&(t=e-i+1),this.range.start!==t&&this.handleUpdate(t,e)}handleUpdate(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback({...this.range})}getFrontOffset(){return this.calcType===l.FIXED?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)}getBehindOffset(){var t=this.getLastIndex();return this.calcType===l.FIXED?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()}getOffsetByIndex(e){if(!e)return 0;let n=0;for(let t=0;t<e;t++){var i=this.sizes.get(this.options.uniqueKeys[t]);n+="number"==typeof i?i:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,e-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),n}getEndByStart(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}getLastIndex(){return this.options.uniqueKeys.length-1}getItemSize(){return this.calcType===l.FIXED?this.calcSize.fixed:this.calcSize.average||this.options.size}handleItemSizeChange(t,e){this.sizes.set(t,e),this.calcType===l.INIT?(this.calcType=l.FIXED,this.calcSize.fixed=e):this.calcType===l.FIXED&&this.calcSize.fixed!==e&&(this.calcType=l.DYNAMIC,this.calcSize.fixed=void 0),this.calcType!==l.FIXED&&(this.calcSize.total=[...this.sizes.values()].reduce((t,e)=>t+e,0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))}handleHeaderSizeChange(t){this.calcSize.header=t}handleFooterSizeChange(t){this.calcSize.footer=t}}(function(t){function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function s(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}()||function(t){if(t){if("string"==typeof t)return r(t,void 0);var e=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(e="Object"===e&&t.constructor?t.constructor.name:e)||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,void 0):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function e(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function a(e,n){n?"none"===n?I.forEach(function(t){return d(e,t,"none")}):I.forEach(function(t){return d(e,t,"".concat(t.split("transition")[0],"transform ").concat(n))}):I.forEach(function(t){return d(e,t,"")})}function l(e,n){n?D.forEach(function(t){return d(e,t,"".concat(t.split("transform")[0]).concat(n))}):D.forEach(function(t){return d(e,t,"")})}function c(t,e,n,i){window.addEventListener?t.addEventListener(e,n,!(!i&&y)&&E):window.attachEvent&&t.attachEvent("on"+e,n)}function h(t,e,n,i){window.removeEventListener?t.removeEventListener(e,n,!(!i&&y)&&E):window.detachEvent&&t.detachEvent("on"+e,n)}function f(t){for(var e={top:0,left:0,height:0,width:0},n=(e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft,t.offsetParent);null!==n;)e.top+=n.offsetTop,e.left+=n.offsetLeft,n=n.offsetParent;return e}function p(t){var e,n;if(t.getBoundingClientRect||t===window)return e={top:0,left:0,bottom:0,right:0,height:0,width:0},t!==window&&t.parentNode&&t!==(!(n=document.scrollingElement)||n.contains(document.body)?document:n)?(n=t.getBoundingClientRect(),e.top=n.top,e.left=n.left,e.bottom=n.bottom,e.right=n.right,e.height=n.height,e.width=n.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}function g(t,n,e){var i=s(Array.from(t.children));if(-1<(t=i.indexOf(n)))return e?i[t]:{index:t,el:i[t],rect:p(i[t]),offset:f(i[t])};for(var o=0;o<i.length;o++)if(function(t){var e;if(n&&t)for(e=n.parentNode;e;){if(t===e)return 1;e=e.parentNode}}(i[o]))return e?i[o]:{index:o,el:i[o],rect:p(i[o]),offset:f(i[o])};return e?null:{index:-1,el:null,rect:{},offset:{}}}function v(t,e,n){var i;t&&e&&(t.classList?t.classList[n?"add":"remove"](e):(i=(" "+t.className+" ").replace(x," ").replace(" "+e+" "," "),t.className=(i+(n?" "+e:"")).replace(x," ")))}function d(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];i[e=e in i||-1!==e.indexOf("webkit")?e:"-webkit-"+e]=n+("string"==typeof n?"":"px")}}function m(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.$el=t,this.options=e=Object.assign({},e),this.dragEl=null,this.dropEl=null,this.differ=null,this.ghost=null;var n,i,o,r={delay:0,delayOnTouchOnly:!1,disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,forceFallback:!1,stopPropagation:!1,supportPassive:(n=!1,document.addEventListener("checkIfSupportPassive",null,{get passive(){return n=!0}}),n),supportPointer:"PointerEvent"in window&&!b,supportTouch:"ontouchstart"in window,ownerDocument:this.$el.ownerDocument};for(i in r)i in this.options||(this.options[i]=r[i]);this.nativeDraggable=!this.options.forceFallback&&_,this.differ=new z,this.ghost=new T(this.options),Object.assign(this,(o=[],{captureAnimationState:function(){var t=s(Array.from(this.$el.children)),e=(i=this.dragEl,e=this.dropEl,(i=(n=t).indexOf(i))<(n=n.indexOf(e))?{start:i,end:n}:{start:n,end:i}),n=e.start,i=e.end;o.length=0,t.slice(n,i+1).forEach(function(t){o.push({target:t,rect:p(t)})})},animateRange:function(){var n=this;o.forEach(function(t){var e=t.target,t=t.rect;n.animate(e,t,n.animation)})},animate:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,i=p(t),o=e.left-i.left,e=e.top-i.top;a(t,"none"),l(t,"translate3d(".concat(o,"px, ").concat(e,"px, 0)")),t.offsetLeft,a(t,"".concat(n,"ms")),l(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){a(t,""),l(t,""),t.animated=null},n)}}),{_bindEventListener:function(){this._onStart=this._onStart.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=(n=this.options).supportPointer,e=n.supportTouch,n=n.supportPassive;c(this.$el,t?"pointerdown":e?"touchstart":"mousedown",this._onStart,n)},_unbindEventListener:function(){var t=this.options.supportPassive;h(this.$el,"pointerdown",this._onStart,t),h(this.$el,"touchstart",this._onStart,t),h(this.$el,"mousedown",this._onStart,t)},_bindMoveEvents:function(t){var e=(i=this.options).supportPointer,n=i.ownerDocument,i=i.supportPassive;c(n,e?"pointermove":t?"touchmove":"mousemove",this._onMove,i)},_bindUpEvents:function(){var t=(e=this.options).ownerDocument,e=e.supportPassive;c(t,"pointerup",this._onDrop,e),c(t,"pointercancel",this._onDrop,e),c(t,"touchend",this._onDrop,e),c(t,"touchcancel",this._onDrop,e),c(t,"mouseup",this._onDrop,e)},_unbindMoveEvents:function(){var t=(e=this.options).ownerDocument,e=e.supportPassive;h(t,"pointermove",this._onMove,e),h(t,"touchmove",this._onMove,e),h(t,"mousemove",this._onMove,e)},_unbindUpEvents:function(){var t=(e=this.options).ownerDocument,e=e.supportPassive;h(t,"pointerup",this._onDrop,e),h(t,"pointercancel",this._onDrop,e),h(t,"touchend",this._onDrop,e),h(t,"touchcancel",this._onDrop,e),h(t,"mouseup",this._onDrop,e)}}),this._bindEventListener(),this._handleDestroy()}var y,S,b,w,E,x,I,D,z,T,_;t.exports=(y=e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),S=e(/Edge/i),b=e(/safari/i)&&!e(/chrome/i)&&!e(/android/i),t=e(/iP(ad|od|hone)/i),w=e(/chrome/i)&&e(/android/i),E={capture:!1,passive:!1},x=/\s+/g,I=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],D=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],z=function(){function t(){n(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return o(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),T=function(){function e(t){n(this,e),this.options=t,this.diff={x:0,y:0},this.position={x:0,y:0},this.exist=!1}return o(e,[{key:"init",value:function(t,e){var n,i;this.$el&&this.$el.remove(),t&&(this.$el=t,n=(t=this.options).ghostClass,t=void 0===(t=t.ghostStyle)?{}:t,i=e.width,e=e.height,this.$el.class=n,this.$el.style.width=i+"px",this.$el.style.height=e+"px",this.$el.style.position="fixed",this.$el.style.left=0,this.$el.style.top=0,this.$el.style.zIndex=1e5,this.$el.style.opacity=.8,this.$el.style.pointerEvents="none",this.$el.style.cursor="move",a(this.$el,"none"),l(this.$el,"translate3d(0px, 0px, 0px)"),this.setStyle(t))}},{key:"setPosition",value:function(t,e){this.position={x:t-this.diff.x,y:e-this.diff.y}}},{key:"setStyle",value:function(t){for(var e in t)d(this.$el,e,t[e])}},{key:"rect",value:function(){return p(this.$el)}},{key:"move",value:function(t){var e;this.$el&&(e=this.options.ghostAnimation,a(this.$el,t?"".concat(e,"ms"):"none"),this.exist||(document.body.appendChild(this.$el),this.exist=!0),l(this.$el,"translate3d(".concat(this.position.x,"px, ").concat(this.position.y,"px, 0)")),"move"!==this.$el.style.cursor&&(this.$el.style.cursor="move"))}},{key:"destroy",value:function(t){var e=this;t&&(this.position={x:t.left,y:t.top},this.move(!0)),(t=this.options.ghostAnimation)?setTimeout(function(){return e.clear()},t):this.clear()}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.$el=null,this.diff={x:0,y:0},this.position={x:0,y:0},this.exist=!1}}]),e}(),_="undefined"!=typeof document&&!w&&!t&&"draggable"in document.createElement("div"),m.prototype={constructor:m,destroy:function(){this._unbindEventListener(),this._resetState()},_onStart:function(t){var e=(o=this.options).delay,n=o.disabled,i=o.stopPropagation,o=o.delayOnTouchOnly;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||n)){var r=(n=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t)||t;if(this.nativeDraggable||!b||!r.target||"SELECT"!==r.target.tagName.toUpperCase()){if(r.target===this.$el)return!0;i&&t.stopPropagation(),!e||o&&!n||this.nativeDraggable&&(S||y)?this._onDrag(r,n):this.dragStartTimer=setTimeout(this._onDrag(r,n),e)}}},_onDrag:function(t,e){var n=(i=this.options).draggable,i=i.dragging;if("function"==typeof n){if(!n(t))return!0}else if("string"==typeof n){if(!function(t,e){if(e&&(">"===e[0]&&(e=e.substring(1)),t))try{return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.webkitMatchesSelector&&t.webkitMatchesSelector(e)}catch(t){return}}(t.target,n))return!0}else if(void 0!==n)throw new Error('draggable expected "function" or "string" but received "'.concat(u(n),'"'));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){throw new Error(t)}if(i){if("function"!=typeof i)throw new Error('dragging expected "function" or "string" but received "'.concat(u(i),'"'));this.dragEl=i(t)}else this.dragEl=g(this.$el,t.target,!0);if(!this.dragEl||this.dragEl.animated)return!0;i=(n=g(this.$el,this.dragEl)).rect,n=n.offset,window.sortableDndOnDownState=!0,this.ghost.setPosition(i.left,i.top),this.ghost.diff={x:t.clientX-i.left,y:t.clientY-i.top},this.differ.from={node:this.dragEl,rect:i,offset:n},this._bindMoveEvents(e),this._bindUpEvents(e)},_onMove:function(t){void 0!==t.preventDefault&&t.preventDefault();var e=(o=this.options).chosenClass,n=o.stopPropagation,i=o.onMove,o=o.onDrag;n&&t.stopPropagation();var r=(n=t.touches&&t.touches[0])||t,s=r.clientX,a=r.clientY,n=n?document.elementFromPoint(s,a):r.target;if(!this.ghost.$el&&(this.ghost.init(this.dragEl.cloneNode(!0),this.differ.from.rect),void 0!==o)){if("function"!=typeof o)throw new Error('onDrag expected "function" but received "'.concat(u(o),'"'));o(this.dragEl,r,t)}if(void 0!==i){if("function"!=typeof i)throw new Error('onMove expected "function" but received "'.concat(u(i),'"'));i(this.differ.from,this.ghost.$el,r,t)}if(v(this.dragEl,e,!0),this.ghost.move(),window.sortableDndOnDownState&&!(s<0||a<0))if(window.sortableDndOnMoveState=!0,this.ghost.setPosition(s,a),this.ghost.move(),s<(o=p(this.$el)).left||s>o.right||a<o.top||a>o.bottom)this.ghost.setStyle({cursor:"not-allowed"});else{var e=(i=g(this.$el,n)).index,o=i.el,n=i.rect,i=i.offset,l=n.left,c=n.right,h=n.top,d=n.bottom;if(o&&!(e<0)&&(this.dropEl=o,l<s&&s<c&&h<a&&a<d&&o!==this.dragEl&&(this.differ.to={node:this.dropEl,rect:n,offset:i},!o.animated))){if(this.captureAnimationState(),e=this.options.onChange,l=f(this.dragEl),void 0!==e){if("function"!=typeof e)throw new Error('onChange expected "function" but received "'.concat(u(e),'"'));e(this.differ.from,this.differ.to,r,t)}l.top<i.top||l.left<i.left?this.$el.insertBefore(this.dragEl,o.nextElementSibling):this.$el.insertBefore(this.dragEl,o),this.animateRange()}}},_onDrop:function(t){this._unbindMoveEvents(),this._unbindUpEvents(),clearTimeout(this.dragStartTimer);var e=this.options,n=e.onDrop,i=e.chosenClass;if(e.stopPropagation&&t.stopPropagation(),v(this.dragEl,i,!1),window.sortableDndOnDownState&&window.sortableDndOnMoveState){if(this.differ.to.offset=f(this.dragEl),this.differ.to.rect=p(this.dragEl),i=(e=this.differ).from,e=e.to,i=i.offset.top!==e.offset.top||i.offset.left!==e.offset.left,void 0!==n){if("function"!=typeof n)throw new Error('onDrop expected "function" but received "'.concat(u(n),'"'));n(i,t)}this.ghost.destroy(p(this.dragEl))}this.differ.destroy(),this._removeWindowState()},_resetState:function(){this.dragEl=null,this.dropEl=null,this.ghost.destroy(),this.differ.destroy(),this._removeWindowState()},_removeWindowState:function(){window.sortableDndOnDownState=null,window.sortableDndOnMoveState=null,window.sortableDndAnimationEnd=null,delete window.sortableDndOnDownState,delete window.sortableDndOnMoveState,delete window.sortableDndAnimationEnd},_handleDestroy:function(){var t=this,e=null,n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(n){var i=this.options.ownerDocument;if(!i)return;(e=new n(function(){i.body.contains(t.$el)||(e.disconnect(),e=null,t._unbindEventListener(),t._resetState())})).observe(this.$el.parentNode,{childList:!0,attributes:!1,subtree:!1})}window.onbeforeunload=function(){e&&e.disconnect(),e=null,t._unbindEventListener(),t._resetState()}}},m)})(h={exports:{}});var s=h.exports;class r{from;to}class ot{getKey;callback;dragState;dragIndex;dragElement;drag;options;cloneList;dataSource;rangeIsChanged;constructor(t,e){this.options=t,this.callback=e,this.getKey=t.getKey,this.dragState=new r,this.dataSource=t.dataSource,this.cloneList=[],this.rangeIsChanged=!1,this.init()}set(t,e){this[t]=e}init(){this.destroy();let r=!1;this.drag=new s(this.options.scrollEl,{disabled:this.options.disabled,draggable:this.options.draggable,dragging:this.options.dragging,ghostStyle:this.options.ghostStyle,ghostClass:this.options.ghostClass,chosenClass:this.options.chosenClass,animation:this.options.animation,onDrag:t=>{this.dragElement=t,this.cloneList=[...this.dataSource];const e=t.getAttribute("data-key");this.dragIndex=this.dataSource.findIndex(t=>this.getKey(t)===e),this.dragState.from.index=this.dragIndex,this.dragState.from.key=e,this.rangeIsChanged=!1},onChange:(t,e)=>{!r&&this.rangeIsChanged&&(r=!0,this.dataSource.splice(this.dragIndex,1));const i=this.dragState.from.key,o=e.node.getAttribute("data-key");this.dragState.to.key=o,this.cloneList.forEach((t,e)=>{var n=this.getKey(t);n===i&&Object.assign(this.dragState.from,{item:t,index:e}),n===o&&Object.assign(this.dragState.to,{item:t,index:e})});var{from:e,to:n}=this.dragState;this.cloneList.splice(e.index,1),this.cloneList.splice(n.index,0,e.item)},onDrop:t=>{this.dragState.to.index=this.cloneList.findIndex(t=>this.getKey(t)===this.dragState.from.key);var{from:e,to:n}=this.dragState;r&&this.rangeIsChanged&&this.dragElement&&this.dragElement.remove(),this.callback(this.cloneList,e,n,t),this.dataSource=[...this.cloneList],this.rangeIsChanged=!1,this.dragElement=null,this.dragIndex=-1,r=!1}})}destroy(){this.drag&&this.drag.destroy(),delete this.drag}}const rt={top:"v-top",bottom:"v-bottom",dragend:"v-dragend"};function c(r,t){const{header:e,footer:n,children:o,dataSource:s=[],dataKey:i,direction:a="vertical",keeps:l=30,size:c=50,height:h="100%",delay:d=0,rootStyle:u={},rootClass:K="",wrapStyle:B={},wrapClass:F="",disabled:N=!1,draggable:f=void 0,dragging:A=void 0,ghostClass:R="",ghostStyle:H={},chosenClass:j="",animation:U=150}=r,[q,p]=Q.useState([]),g=Q.useRef([]),v=Q.useRef([]),[m,X]=Q.useState({start:0,end:l-1,front:0,behind:0}),y=Q.useRef(null),S=Q.useRef(null),b=Q.useRef(null),w=Q.useRef(null),E=Q.useRef(null),x=()=>{var t=y.current;return t?Math.ceil(t[C]):0},I=t=>{y.current[C]=t},D=t=>{var e;t>=s.length-1?T():(e=E.current.getOffsetByIndex(t),I(e),setTimeout(()=>{x()!==E.current.getOffsetByIndex(t)&&D(t)},5))},z=()=>{y.current[C]=0},T=()=>{var t;b.current&&(t=b.current[W],y.current.scrollTop=t,setTimeout(()=>{var t=y.current;x()+Math.ceil(t[O])<Math.ceil(t[_])&&T()},5))},{scrollSizeKey:_,scrollDirectionKey:C,offsetSizeKey:W,clientSizeKey:O}=(Z.useImperativeHandle(t,()=>({reset:()=>{z(),p(()=>[...s]),g.current=[...s]},getSize:t=>E.current.sizes.get(t),getOffset:x,scrollToTop:z,scrollToIndex:D,scrollToOffset:I,scrollToBottom:T})),Q.useEffect(()=>{g.current=[...s],$(),E.current=new it({size:c,keeps:l,uniqueKeys:v.current,isHorizontal:"vertical"===a},t=>{X(()=>t),w.current.set("rangeIsChanged",!0)}),E.current.updateRange(),E.current.updateSizes(v.current),w.current&&w.current.set("dataSource",s),p(()=>[...s])},[s]),Z.useMemo(()=>{var t="vertical"!==a;return{offsetSizeKey:t?"offsetLeft":"offsetTop",scrollSizeKey:t?"scrollWidth":"scrollHeight",clientSizeKey:t?"clientWidth":"clientHeight",scrollDirectionKey:t?"scrollLeft":"scrollTop"}},[a])),M=()=>{w.current&&w.current.destroy(),w.current=null},$=(Q.useLayoutEffect(()=>{f?(M(),w.current=new ot({getKey:k,scrollEl:S.current,dataSource:g.current,disabled:N,draggable:f,dragging:A,ghostStyle:H,ghostClass:R,chosenClass:j,animation:U},(t,e,n,i)=>{const o=r[rt.dragend];o&&o(t,e,n,i),g.current=[...t],p(()=>[...t]),$()})):M()},[f]),Q.useEffect(()=>()=>{M()},[]),()=>{v.current=g.current.map(t=>k(t))}),k=Z.useCallback(t=>i.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce((t,e)=>(t||{})[e],t)||"",[i]);const V=(t,e)=>{E.current.handleItemSizeChange(t,e)};var t=(t,e)=>{"header"===t&&E.current.handleHeaderSizeChange(e),"footer"===t&&E.current.handleFooterSizeChange(e)},{start:Y,end:G,front:L,behind:P}=Z.useMemo(()=>({...m}),[m]),J={...u,height:h,overflow:"vertical"!==a?"auto hidden":"hidden auto"},L={...B,padding:"vertical"!==a?`0px ${P}px 0px ${L}px`:L+`px 0px ${P}px`};return Z.createElement("div",{ref:y,className:K,style:J,onScroll:nt(t=>{var e=y.current,n=x(),i=Math.ceil(e[O]),e=Math.ceil(e[_]);n<0||e+1<n+i||!e||(E.current.handleScroll(n),E.current.isFront()?s.length&&n<=0&&nt(()=>{const t=r[rt.top];t&&t()}):E.current.isBehind()&&e<=i+n&&nt(()=>{const t=r[rt.bottom];t&&t()}))},d)},Z.createElement(et,{children:e,roleId:"header",onSizeChange:t}),Z.createElement("div",{ref:S,"v-role":"content",className:F,style:L},q.slice(Y,G+1).map(t=>{var e,n=k(t),i=(e=t,g.current.findIndex(t=>k(t)===k(e)));return Z.createElement(tt,{key:n,uniqueKey:n,children:o,record:t,index:i,onSizeChange:V})})),Z.createElement(et,{children:n,roleId:"footer",onSizeChange:t}),Z.createElement("div",{ref:b}))}var h=Z.forwardRef(c);t.VirtualDragList=c,t.default=h,Object.defineProperty(t,"__esModule",{value:!0})});
