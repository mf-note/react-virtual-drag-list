!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList={},t.React)}(this,function(t,St){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}function n(n){if(n&&n.__esModule)return n;var i=Object.create(null);return n&&Object.keys(n).forEach(function(t){var e;"default"!==t&&(e=Object.getOwnPropertyDescriptor(n,t),Object.defineProperty(i,t,e.get?e:{enumerable:!0,get:function(){return n[t]}}))}),i.default=n,Object.freeze(i)}var l=n(St),wt=e(St);function i(e,t){var n,i=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)),i}function Et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){c(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function xt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var Tt=a(function t(){o(this,t),c(this,"from",void 0),c(this,"to",void 0),this.from={key:void 0,item:void 0,index:-1},this.to={key:void 0,item:void 0,index:-1}}),d=a(function t(){o(this,t),c(this,"average",void 0),c(this,"total",void 0),c(this,"fixed",void 0),c(this,"header",void 0),c(this,"footer",void 0),this.average=0,this.total=0,this.fixed=0,this.header=0,this.footer=0}),kt=a(function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),c(this,"start",void 0),c(this,"end",void 0),c(this,"front",void 0),c(this,"behind",void 0),this.start=e.start||0,this.end=e.end||0,this.front=e.front||0,this.behind=e.behind||0});function f(t){var e=t.dataKey,n=t.children,i=t.onSizeChange,o=l.useRef(null),t="function"==typeof n?n(o):n;return l.useLayoutEffect(function(){var t;return void 0!==("undefined"==typeof ResizeObserver?"undefined":r(ResizeObserver))&&(t=new ResizeObserver(function(){var t=o.current.clientHeight;i&&i(e,t)}),o.current&&t.observe(o.current)),function(){t&&(t.disconnect(),t=null)}},[o]),l.cloneElement(t,{ref:o})}function Ot(t){var e=t.children,n=t.dataKey,i=t.Class,o=t.Style,r=t.Tag,s=t.record,a=t.index,t=t.onSizeChange;return l.createElement(f,{dataKey:n,onSizeChange:t},l.createElement(void 0===r?"div":r,{className:i,style:o,"data-key":n},"function"==typeof e?e(s,a,n):e))}function _t(t){var e=t.Tag,n=t.Style,i=t.Class,o=t.children,r=t.roleId,t=t.onSizeChange;return o?l.createElement(f,{dataKey:r,onSizeChange:t},l.createElement(void 0===e?"div":e,{"v-role":r,style:n,className:i},o)):l.createElement(l.Fragment,null)}function zt(r,t,e){function n(){for(var t,e=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s&&clearTimeout(s),c?(t=!s,s=setTimeout(function(){s=null},l),t&&(a=r.apply(this,i))):s=setTimeout(function(){r.apply(e,i)},l),a}var s,a,l=1<arguments.length&&void 0!==t?t:50,c=2<arguments.length&&void 0!==e&&e;return n.prototype.cancel=function(){clearTimeout(s),s=null},n}(function(t){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function e(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function l(e,n){n?"none"===n?z.forEach(function(t){return b(e,t,"none")}):z.forEach(function(t){return b(e,t,"".concat(t.split("transition")[0],"transform ").concat(n))}):z.forEach(function(t){return b(e,t,"")})}function c(e,n){n?C.forEach(function(t){return b(e,t,"".concat(t.split("transform")[0]).concat(n))}):C.forEach(function(t){return b(e,t,"")})}function u(t){var e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,t=e||t;return{touch:e,e:t,target:e?document.elementFromPoint(t.clientX,t.clientY):t.target}}function h(t,e,n){window.addEventListener?t.addEventListener(e,n,!(!I&&x)&&O):window.attachEvent&&t.attachEvent("on"+e,n)}function d(t,e,n){window.removeEventListener?t.removeEventListener(e,n,!(!I&&x)&&O):window.detachEvent&&t.detachEvent("on"+e,n)}function f(t){for(var e={top:0,left:0,height:0,width:0},n=(e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft,t.offsetParent);null!==n;)e.top+=n.offsetTop,e.left+=n.offsetLeft,n=n.offsetParent;return e}function g(t,e){if(!t||!t.getBoundingClientRect)return p();var n=t,i=!1;do{if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var o=b(n);if(n.clientWidth<n.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||n.clientHeight<n.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!n.getBoundingClientRect||n===document.body)return p();if(i||e)return n;i=!0}}}while(n=n.parentNode);return p()}function p(){var t=document.scrollingElement;return!t||t.contains(document.body)?document:t}function v(t){var e;if(t.getBoundingClientRect||t===window)return e={top:0,left:0,bottom:0,right:0,height:0,width:0},t!==window&&t.parentNode&&t!==p()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}function m(t,e,n){var i=r(Array.from(t.children)),t=i.indexOf(e);if(-1<t)return n?i[t]:{index:t,el:i[t],rect:v(i[t]),offset:f(i[t])};for(var o=0;o<i.length;o++)if(function(t,e){var n;if(t&&e)for(n=t.parentNode;n;){if(e===n)return 1;n=n.parentNode}return}(e,i[o]))return n?i[o]:{index:o,el:i[o],rect:v(i[o]),offset:f(i[o])};return n?null:{index:-1,el:null,rect:{},offset:{}}}function y(t,e,n){var i;t&&e&&(t.classList?t.classList[n?"add":"remove"](e):(i=(" "+t.className+" ").replace(_," ").replace(" "+e+" "," "),t.className=(i+(n?" "+e:"")).replace(_," ")))}function b(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];i[e=e in i||-1!==e.indexOf("webkit")?e:"-webkit-"+e]=n+("string"==typeof n?"":"px")}}function S(n,i,o){var r=null;return function(){var t=this,e=arguments;r&&clearTimeout(r),o&&!r&&n.apply(t,e),r=setTimeout(function(){n.apply(t,e)},i)}}function w(n,i){var o=null;return function(){var t=this,e=arguments;o=o||setTimeout(function(){o=null,n.apply(t,e)},i)}}function $(){var o=[];return{captureAnimationState:function(){var t=r(Array.from(this.rootEl.children)),e=(n=t,i=this.dragEl,e=this.dropEl,i=n.indexOf(i),n=n.indexOf(e),i<n?{start:i,end:n}:{start:n,end:i}),n=e.start,i=e.end;o.length=0,t.slice(n,i+1).forEach(function(t){o.push({target:t,rect:v(t)})})},animateRange:function(){var n=this;o.forEach(function(t){var e=t.target,t=t.rect;n.animate(e,t,n.options.animation)})},animate:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,i=v(t),o=e.left-i.left,e=e.top-i.top;l(t,"none"),c(t,"translate3d(".concat(o,"px, ").concat(e,"px, 0)")),t.offsetLeft,l(t,"".concat(n,"ms")),c(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){l(t,""),c(t,""),t.animated=null},n)}}}function E(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.rootEl=t,this.scrollEl=g(t,!0),this.options=e=Object.assign({},e),this.ownerDocument=t.ownerDocument;var n,i={autoScroll:!0,scrollStep:5,scrollThreshold:15,delay:0,delayOnTouchOnly:!1,disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,fallbackOnBody:!1,forceFallback:!1,stopPropagation:!1,supportPointer:"PointerEvent"in window&&!T,supportTouch:"ontouchstart"in window};for(n in i)n in this.options||(this.options[n]=i[n]);this.container=this.options.fallbackOnBody?document.body:this.rootEl,this.nativeDraggable=!this.options.forceFallback&&j,this.move={x:0,y:0},this.state=new M,this.differ=new A,this.ghost=new P(this),this.dragEl=null,this.dropEl=null,this.dragStartTimer=null,this.autoScrollTimer=null,Object.assign(this,{_bindEventListener:function(){this._onDrag=this._onDrag.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,t=t.supportTouch;h(this.rootEl,e?"pointerdown":t?"touchstart":"mousedown",this._onDrag)},_clearEvent:function(){d(this.rootEl,"pointerdown",this._onDrag),d(this.rootEl,"touchstart",this._onDrag),d(this.rootEl,"mousedown",this._onDrag)},_bindMoveEvents:function(t){this.options.supportPointer?h(this.ownerDocument,"pointermove",this._onMove):h(this.ownerDocument,t?"touchmove":"mousemove",this._onMove)},_unbindMoveEvents:function(){d(this.ownerDocument,"pointermove",this._onMove),d(this.ownerDocument,"touchmove",this._onMove),d(this.ownerDocument,"mousemove",this._onMove)},_unbindDropEvents:function(){d(this.ownerDocument,"pointerup",this._onDrop),d(this.ownerDocument,"pointercancel",this._onDrop),d(this.ownerDocument,"touchend",this._onDrop),d(this.ownerDocument,"touchcancel",this._onDrop),d(this.ownerDocument,"mouseup",this._onDrop)},_unbindDragEvents:function(){this.nativeDraggable&&(d(this.rootEl,"dragstart",this._onDragStart),d(this.rootEl,"dragover",this._onDragOver),d(this.rootEl,"dragend",this._onDrop))}},$(),(window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),{_autoScroll:w(function(t){var e,n,i,o,r,s,a,l,c,u,h,d,f,g,p;t.state.sortableDown&&t.state.sortableMove&&(e=(n=t.state.sortableMove).clientX,n=n.clientY,void 0!==e&&void 0!==n&&t.scrollEl!==t.ownerDocument&&(i=(g=t.scrollEl).scrollTop,o=g.scrollLeft,r=g.scrollHeight,g=g.scrollWidth,s=(f=v(t.scrollEl)).top,h=f.right,a=f.bottom,d=f.left,l=f.height,f=f.width,c=(u=t.options).scrollStep,u=u.scrollThreshold,d=0<o&&d<=e&&e<=d+u,f=o+f<g&&e<=h&&h-u<=e,g=i+l<r&&n<=a&&a-u<=n,p={x:o,y:i},(h=0<i&&s<=n&&n<=s+u)?(p.x=d?o-c:f?o+c:o,p.y=i-c):g?(p.x=d?o-c:f?o+c:o,p.y=i+c):d?(p.x=o-c,p.y=i):f&&(p.x=o+c,p.y=i),(h||d||f||g)&&requestAnimationFrame(function(){t.scrollEl.scrollTo(p.x,p.y),t._autoScroll(t)})))},10)})),this._bindEventListener()}var x,D,T,k,O,_,z,C,I,M,A,P,j;t.exports=(x=e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),D=e(/Edge/i),T=e(/safari/i)&&!e(/chrome/i)&&!e(/android/i),t=e(/iP(ad|od|hone)/i),k=e(/chrome/i)&&e(/android/i),O={capture:!1,passive:!1},_=/\s+/g,z=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],C=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],I=function(){var t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0}}),t}(),M=o(function t(){n(this,t),this.sortableDown=void 0,this.sortableMove=void 0,this.animationEnd=void 0}),A=function(){function t(){n(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return o(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),P=function(){function e(t){n(this,e),this.$el=null,this.distance={x:0,y:0},this.options=t.options,this.container=t.container}return o(e,[{key:"init",value:function(t,e){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],t=(this.$el=t,this.options),i=t.ghostClass,t=t.ghostStyle,t=void 0===t?{}:t;y(this.$el,i,!0),b(this.$el,"box-sizing","border-box"),b(this.$el,"margin",0),b(this.$el,"top",e.top),b(this.$el,"left",e.left),b(this.$el,"width",e.width),b(this.$el,"height",e.height),b(this.$el,"opacity","0.8"),b(this.$el,"position","fixed"),b(this.$el,"zIndex","100000"),b(this.$el,"pointerEvents","none"),this.setStyle(t),l(this.$el,"none"),c(this.$el,"translate3d(0px, 0px, 0px)"),n&&this.container.appendChild(this.$el),b(this.$el,"transform-origin",this.distance.x/parseInt(this.$el.style.width)*100+"% "+this.distance.y/parseInt(this.$el.style.height)*100+"%")}},{key:"setStyle",value:function(t){for(var e in t)b(this.$el,e,t[e])}},{key:"rect",value:function(){return v(this.$el)}},{key:"move",value:function(t,e){this.$el&&(l(this.$el,2<arguments.length&&void 0!==arguments[2]&&arguments[2]?"".concat(this.options.ghostAnimation,"ms"):"none"),c(this.$el,"translate3d(".concat(t,"px, ").concat(e,"px, 0)")))}},{key:"destroy",value:function(t){var e,n,i=this;this.$el&&(n=parseInt(this.$el.style.left),e=parseInt(this.$el.style.top),this.move(t.left-n,t.top-e,!0),(n=this.options.ghostAnimation)?setTimeout(function(){return i.clear()},n):this.clear())}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.distance={x:0,y:0},this.$el=null}}]),e}(),j="undefined"!=typeof document&&!k&&!t&&"draggable"in document.createElement("div"),(E.prototype={constructor:E,destroy:function(){this._clearState(),this._clearEvent(),Array.prototype.forEach.call(this.rootEl.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")})},set:function(t,e){this.options[t]=e},get:function(t){return this.options[t]},_onDrag:function(t){var e=this;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||this.options.disabled)){var n=u(t),i=n.touch,o=n.e,n=n.target;if(this.nativeDraggable||!T||!n||"SELECT"!==n.tagName.toUpperCase()){if(n===this.rootEl)return!0;this.options.stopPropagation&&t.stopPropagation();var t=this.options,r=t.draggable,t=t.dragging;if("function"==typeof r){if(!r(o))return!0}else if("string"==typeof r){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return}return}}(n,r))return!0}else if(void 0!==r)throw new Error('draggable expected "function" or "string" but received "'.concat(s(r),'"'));if(t){if("function"!=typeof t)throw new Error('dragging expected "function" or "string" but received "'.concat(s(t),'"'));this.dragEl=t(o)}else this.dragEl=m(this.rootEl,n,!0);if(!this.dragEl||this.dragEl.animated)return!0;i&&(this.dragEl.style["touch-action"]="none");r=m(this.rootEl,this.dragEl),t=r.rect,n=r.offset,r=(this.move={x:o.clientX,y:o.clientY},this.differ.from={node:this.dragEl,rect:t,offset:n},this.ghost.distance={x:o.clientX-t.left,y:o.clientY-t.top},this.state.sortableDown=o,h(this.ownerDocument,"pointerup",this._onDrop),h(this.ownerDocument,"touchend",this._onDrop),h(this.ownerDocument,"mouseup",this._onDrop),this.options),n=r.delay,t=r.delayOnTouchOnly;!n||t&&!i||this.nativeDraggable&&(D||x)?this._onStart(o,i):(clearTimeout(this.dragStartTimer),this.dragStartTimer=setTimeout(function(){return e._onStart(o,i)},n))}}},_onStart:function(t,e){!this.nativeDraggable||e?(this._bindMoveEvents(e),h(this.ownerDocument,"pointercancel",this._onDrop),h(this.ownerDocument,"touchcancel",this._onDrop)):(this.dragEl.draggable=!0,this._onDragStart=this._onDragStart.bind(this),this._onDragOver=this._onDragOver.bind(this),h(this.rootEl,"dragstart",this._onDragStart));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){}},_onDragStart:function(t){t.dataTransfer.setData("te",t.target.innerText),h(this.rootEl,"dragover",this._onDragOver),h(this.rootEl,"dragend",this._onDrop)},_onDragOver:function(t){var e,n,i,o;this.state.sortableDown&&(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),e=t.clientX,n=t.clientY,i=e-this.move.x,o=n-this.move.y,void 0!==e&&Math.abs(i)<=0&&void 0!==n&&Math.abs(o)<=0||(this._onStarted(t,t),t.target!==this.rootEl&&this._onChange(this,t.target,t,t)))},_onMove:function(t){var e,n,i,o,r,s,a,l,c=this;this.state.sortableDown&&(e=(n=u(t)).e,n=n.target,i=e.clientX,o=e.clientY,s=i-this.move.x,r=o-this.move.y,void 0!==i&&Math.abs(s)<=0&&void 0!==o&&Math.abs(r)<=0||(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),this._onStarted(e,t),this.ghost.move(s,r),(s=this.options.onMove)&&"function"==typeof s&&s(this.differ.from,this.ghost.$el,e,t),i<0||o<0||(s=(r=v(this.rootEl)).top,a=r.right,l=r.bottom,i<r.left||a<i||o<s||l<o||(this._onChange(this,n,e,t),this.autoScrollTimer&&clearTimeout(this.autoScrollTimer),this.options.autoScroll&&(this.autoScrollTimer=setTimeout(function(){return c._autoScroll(c)},0))))))},_onStarted:function(t,e){var n;this.state.sortableMove=t,this.ghost.$el||((n=this.options.onDrag)&&"function"==typeof n&&n(this.dragEl,t,e),n=this.differ.from.rect,t=this.dragEl.cloneNode(!0),this.ghost.init(t,n,!this.nativeDraggable),y(this.dragEl,this.options.chosenClass,!0),this.dragEl.style["will-change"]="transform",T&&b(document.body,"user-select","none"),this.nativeDraggable&&this._unbindDropEvents())},_onChange:S(function(t,e,n,i){var o,r,s,a,l,c,e=m(t.rootEl,e),u=e.el,h=e.rect,e=e.offset;u&&!u.animated&&(t.dropEl=u,c=n.clientX,o=n.clientY,l=h.left,r=h.right,s=h.top,a=h.bottom,l<c&&c<r&&s<o&&o<a&&u!==t.dragEl&&(t.differ.to={node:t.dropEl,rect:h,offset:e},t.captureAnimationState(),l=t.options.onChange,c=f(t.dragEl),l&&"function"==typeof l&&l(t.differ.from,t.differ.to,n,i),c.top<e.top||c.left<e.left?t.rootEl.insertBefore(t.dragEl,u.nextElementSibling):t.rootEl.insertBefore(t.dragEl,u),t.animateRange()))},5),_onDrop:function(t){this._unbindDragEvents(),this._unbindMoveEvents(),this._unbindDropEvents(),this.dragStartTimer&&clearTimeout(this.dragStartTimer),this.options.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var e,n=u(t).touch;y(this.dragEl,this.options.chosenClass,!1),this.nativeDraggable&&(this.dragEl.draggable=!1),n&&(this.dragEl.style["touch-action"]=""),this.dragEl.style["will-change"]="",this.state.sortableDown&&this.state.sortableMove&&(this.differ.to.offset=f(this.dragEl),this.differ.to.rect=v(this.dragEl),e=(n=this.differ).from,n=n.to,e=e.offset.top!==n.offset.top||e.offset.left!==n.offset.left,(n=this.options.onDrop)&&"function"==typeof n&&n(e,t)),T&&b(document.body,"user-select",""),this.ghost.destroy(this.differ.to.rect),this.state=new M},_clearState:function(){this.state=new M,this.differ.destroy(),this.dragEl=null,this.dropEl=null}}).utils={getRect:v,getOffset:f,debounce:S,throttle:w,getParentAutoScrollElement:g},E)})(w={exports:{}});var g=w.exports,Ct=function(){function i(t,e,n){o(this,i),c(this,"onDrag",void 0),c(this,"onDrop",void 0),c(this,"dragState",void 0),c(this,"dragElement",void 0),c(this,"drag",void 0),c(this,"options",void 0),c(this,"dataSource",void 0),c(this,"cloneList",void 0),c(this,"rangeIsChanged",void 0),this.options=t,this.onDrag=e,this.onDrop=n,this.dataSource=t.dataSource,this.cloneList=new Array,this.dragState=new Tt,this.rangeIsChanged=!1,this.init()}return a(i,[{key:"set",value:function(t,e){this[t]=e,"dataSource"===t&&this.dragElement&&this.dragStart(this.dragElement,!1)}},{key:"setOption",value:function(t,e){this.options[t]=e,this.drag.set(t,e)}},{key:"init",value:function(){var n=this,t=this.options,e=t.disabled,i=t.draggable,o=t.ghostClass,r=t.ghostStyle,s=t.chosenClass,a=t.animation,l=t.autoScroll,c=t.scrollStep,t=t.scrollThreshold;this.drag=new g(this.options.scrollEl,{disabled:e,draggable:i,ghostClass:o,ghostStyle:r,chosenClass:s,animation:a,autoScroll:l,scrollStep:c,scrollThreshold:t,onChange:function(t,e){return n.onChange(t,e)},onDrag:function(t){return n.dragStart(t)},onDrop:function(t){return n.dragEnd(t)}})}},{key:"dragStart",value:function(t){var n=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=(this.dragElement=t,this.cloneList=Dt(this.dataSource),t.getAttribute("data-key"));this.dataSource.forEach(function(t,e){n.options.getKey(t)==i&&(n.dragState.from={item:t,index:e,key:i})}),e?(this.rangeIsChanged=!1,this.onDrag(this.dragState.from,t)):this.rangeIsChanged=!0}},{key:"onChange",value:function(t,e){var i=this,o=this.dragState.from.key,r=e.node.getAttribute("data-key"),s={item:null,index:-1},a={item:null,index:-1};this.cloneList.forEach(function(t,e){var n=i.options.getKey(t);n==o&&Object.assign(s,{item:t,index:e}),n==r&&Object.assign(a,{item:t,index:e})}),this.cloneList.splice(s.index,1),this.cloneList.splice(a.index,0,s.item)}},{key:"dragEnd",value:function(t){var n=this,i=this.options.getKey,o=(this.rangeIsChanged&&this.dragElement&&this.dragElement.remove(),this.dragState.from);this.cloneList.forEach(function(t,e){i(t)==o.key&&(n.dragState.to={index:e,key:i(t),item:n.dataSource[e]})}),this.onDrop(this.cloneList,o,this.dragState.to,t),this.dataSource=Dt(this.cloneList),this.clear()}},{key:"clear",value:function(){this.dragElement=null,this.rangeIsChanged=!1,this.dragState=new Tt}},{key:"destroy",value:function(){this.drag&&this.drag.destroy(),this.drag=null}}]),i}(),p="INIT",v="FIXED",m="DYNAMIC",y="FRONT",b="BEHIND",It=function(){function n(t,e){o(this,n),c(this,"options",void 0),c(this,"callback",void 0),c(this,"sizes",void 0),c(this,"isHorizontal",void 0),c(this,"calcIndex",void 0),c(this,"calcType",void 0),c(this,"calcSize",void 0),c(this,"range",void 0),c(this,"direction",void 0),c(this,"offset",void 0),this.options=Et({},t),this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=p,this.calcSize=new d,this.direction="",this.offset=0,this.range=new kt,t&&this.checkIfUpdate(0,t.keeps-1)}return a(n,[{key:"updateUniqueKeys",value:function(t){this.options.uniqueKeys=t}},{key:"updateSizes",value:function(n){var i=this;this.sizes.forEach(function(t,e){n.includes(e)||i.sizes.delete(e)})}},{key:"updateRange",value:function(){var t=this,e=Math.max(this.range.start,0),n=Math.min(this.options.keeps,this.options.uniqueKeys.length);this.sizes.size>=n-2?this.handleUpdate(e,this.getEndByStart(e)):window.requestAnimationFrame?window.requestAnimationFrame(function(){return t.updateRange()}):setTimeout(function(){return t.updateRange()},3)}},{key:"handleScroll",value:function(t){this.direction=t<this.offset?y:b,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)}},{key:"isFront",value:function(){return this.direction===y}},{key:"isBehind",value:function(){return this.direction===b}},{key:"isFixed",value:function(){return this.calcType===v}},{key:"getScrollItems",value:function(t){var e=this.calcSize,n=e.fixed,e=e.header;if(e&&(t-=e),t<=0)return 0;if(this.isFixed())return Math.floor(t/n);for(var i,o,r=0,s=this.options.uniqueKeys.length;r<=s;){if(i=r+Math.floor((s-r)/2),(o=this.getOffsetByIndex(i))===t)return i;o<t?r=i+1:t<o&&(s=i-1)}return 0<r?--r:0}},{key:"handleScrollFront",value:function(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))}},{key:"handleScrollBehind",value:function(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))}},{key:"checkIfUpdate",value:function(t,e){var n=this.options,i=n.uniqueKeys,n=n.keeps;i.length<=n?(t=0,e=i.length-1):e-t<n-1&&(t=e-n+1),this.range.start!==t&&this.handleUpdate(t,e)}},{key:"handleUpdate",value:function(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback(Et({},this.range))}},{key:"getFrontOffset",value:function(){return this.isFixed()?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)}},{key:"getBehindOffset",value:function(){var t=this.getLastIndex();return this.isFixed()?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()}},{key:"getOffsetByIndex",value:function(t){if(!t)return 0;for(var e=0,n=0;n<t;n++){var i=this.sizes.get(this.options.uniqueKeys[n]);e+="number"==typeof i?i:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,t-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),e}},{key:"getEndByStart",value:function(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}},{key:"getLastIndex",value:function(){var t=this.options,e=t.uniqueKeys,t=t.keeps;return 0<e.length?e.length-1:t-1}},{key:"getItemSize",value:function(){return this.isFixed()?this.calcSize.fixed:this.calcSize.average||this.options.size}},{key:"handleItemSizeChange",value:function(t,e){this.sizes.set(t,e),this.calcType===p?(this.calcType=v,this.calcSize.fixed=e):this.isFixed()&&this.calcSize.fixed!==e&&(this.calcType=m,this.calcSize.fixed=void 0),this.calcType!==v&&(this.calcSize.total=Dt(this.sizes.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))}},{key:"handleHeaderSizeChange",value:function(t){this.calcSize.header=t}},{key:"handleFooterSizeChange",value:function(t){this.calcSize.footer=t}}]),n}(),Mt="v-top",At="v-bottom",Pt="v-dragstart",jt="v-dragend";function S(s,t){function $(){e(),E(function(){return Dt(h)}),x.current=Dt(h)}function L(t){return I.current.sizes.get(t)}function n(t){k.current[P]=t}function i(t){var e;t>=h.length-1?o():(e=I.current.getOffsetByIndex(t),n(e),setTimeout(function(){M()!==I.current.getOffsetByIndex(t)&&i(t)},5))}function e(){k.current[P]=0}function o(){var t;O.current&&(t=O.current[ft],k.current[P]=t,setTimeout(function(){var t=k.current;M()+Math.ceil(t[gt])<Math.ceil(t[dt])&&o()},5))}function R(t,e){I.current.handleItemSizeChange(t,e)}function r(t,e){"header"===t&&I.current.handleHeaderSizeChange(e),"footer"===t&&I.current.handleFooterSizeChange(e)}var a,l,c,B=s.header,K=s.footer,F=s.children,u=s.dataSource,h=void 0===u?[]:u,d=s.dataKey,u=s.direction,f=void 0===u?"vertical":u,u=s.keeps,g=void 0===u?30:u,u=s.size,u=void 0===u?null:u,p=s.delay,p=void 0===p?10:p,v=s.keepOffset,H=void 0!==v&&v,v=s.autoScroll,N=void 0===v||v,v=s.scrollStep,q=void 0===v?5:v,v=s.scrollThreshold,W=void 0===v?15:v,v=s.style,U=void 0===v?{}:v,v=s.className,v=void 0===v?"":v,m=s.wrapTag,X=void 0===m?"div":m,m=s.rootTag,Y=void 0===m?"div":m,m=s.itemTag,V=void 0===m?"div":m,m=s.headerTag,m=void 0===m?"div":m,y=s.footerTag,y=void 0===y?"div":y,b=s.itemStyle,G=void 0===b?{}:b,b=s.itemClass,J=void 0===b?"":b,b=s.wrapStyle,Q=void 0===b?{}:b,b=s.wrapClass,b=void 0===b?"":b,S=s.disabled,w=void 0!==S&&S,S=s.draggable,Z=void 0===S?void 0:S,S=s.ghostClass,tt=void 0===S?"":S,S=s.ghostStyle,et=void 0===S?{}:S,S=s.chosenClass,nt=void 0===S?"":S,S=s.animation,it=void 0===S?150:S,S=xt(St.useState([]),2),ot=S[0],E=S[1],x=St.useRef([]),D=St.useRef([]),S=xt(St.useState(new kt({end:g-1})),2),T=S[0],rt=S[1],k=St.useRef(null),st=St.useRef(null),O=St.useRef(null),_=St.useRef(null),z=St.useRef(new Tt),C=St.useRef(null),I=St.useRef(new It({size:u,keeps:g,uniqueKeys:D.current,isHorizontal:"vertical"===f},function(t){void 0===z.current.to.key&&rt(function(){return t});var e=(z.current.from||{}).index;-1<e&&!(e>=t.start&&e<=t.end)&&C.current&&C.current.set("rangeIsChanged",!0)})),M=function(){var t=k.current;return t?Math.ceil(t[P]):0},at=(wt.default.useImperativeHandle(t,function(){return{reset:$,getSize:L,getOffset:M,scrollToTop:e,scrollToIndex:i,scrollToOffset:n,scrollToBottom:o}}),St.useEffect(function(){var t;x.current=Dt(h),E(function(){return Dt(h)}),ct(),I.current.updateUniqueKeys(D.current),I.current.updateSizes(D.current),setTimeout(function(){return I.current.updateRange()},0),C.current?C.current.set("dataSource",h):at(),_.current&&H&&(t=ut(_.current),i(t),_.current=null)},[h]),St.useEffect(function(){C.current&&C.current.setOption("disabled",w)},[w]),St.useEffect(function(){return function(){lt()}},[]),function(){C.current=new Ct({getKey:A,scrollEl:st.current,dataSource:x.current,disabled:w,draggable:Z,ghostStyle:et,ghostClass:tt,chosenClass:nt,animation:it,autoScroll:N,scrollStep:q,scrollThreshold:W},function(t,e){z.current.from=t;var n=s[Pt];n&&n(ot,t,e)},function(n,t,e,i){z.current.to=e;var o,r=s[jt];r&&r(n,t,e,i),i&&(C.current.rangeIsChanged&&I.current.direction&&(o=x.current,rt(function(t){var e;return 0<t.start&&-1<(e=n.indexOf(o[t.start]))?Et(Et({},t),{},{start:e,end:e+g-1}):Et({},t)})),x.current=Dt(n),E(function(){return Dt(n)}),ct()),ht()})}),lt=function(){C.current&&C.current.destroy(),C.current=null},ct=function(){D.current=x.current.map(function(t){return A(t)})},ut=function(e){return x.current.findIndex(function(t){return A(t)===A(e)})},A=wt.default.useCallback(function(t){return d.replace(/\[/g,".").replace(/\]/g,"").split(".").reduce(function(t,e){return(t||{})[e]},t)},[d]),ht=(a=function(){z.current=new Tt},l=p+17,c=null,function(){var t=this,e=arguments;c=c||setTimeout(function(){c=null,a.apply(t,e)},l)}),S=wt.default.useMemo(function(){var t="vertical"!==f;return{offsetSizeKey:t?"offsetLeft":"offsetTop",scrollSizeKey:t?"scrollWidth":"scrollHeight",clientSizeKey:t?"clientWidth":"clientHeight",scrollDirectionKey:t?"scrollLeft":"scrollTop"}},[f]),dt=S.scrollSizeKey,P=S.scrollDirectionKey,ft=S.offsetSizeKey,gt=S.clientSizeKey,pt=zt(function(){_.current=x.current[0];var t=s[Mt];t&&t()}),vt=zt(function(){var t=s[At];t&&t()}),mt=wt.default.useCallback(function(t){var e=C.current&&C.current.rangeIsChanged,n=(z.current.from||{}).key;return e&&t==n?{display:"none"}:{}},[z.current]),u=wt.default.useMemo(function(){return{RTag:Y,WTag:X}},[X,Y]),t=u.RTag,S=u.WTag,u=wt.default.useMemo(function(){return Et(Et({},U),{},{overflow:"vertical"!==f?"auto hidden":"hidden auto"})},[U,f]),yt=wt.default.useMemo(function(){var t=T.front,e=T.behind;return Et(Et({},Q),{},{padding:"vertical"!==f?"0px ".concat(e,"px 0px ").concat(t,"px"):"".concat(t,"px 0px ").concat(e,"px")})},[Q,f,T]),j=wt.default.useMemo(function(){return Et({},T)},[T]),bt=j.start,j=j.end;return wt.default.createElement(t,{ref:k,className:v,style:u,onScroll:zt(function(t){var e,n,i;void 0!==z.current.to.key?ht():(i=k.current,e=M(),n=Math.ceil(i[gt]),i=Math.ceil(i[dt]),e<0||i+1<e+n||!i||(I.current.handleScroll(e),I.current.isFront()?h.length&&e<=0&&pt():I.current.isBehind()&&i<=n+e&&vt()))},p)},wt.default.createElement(_t,{children:B,roleId:"header",Tag:m,onSizeChange:r}),wt.default.createElement(S,{ref:st,"v-role":"group",className:b,style:yt},ot.slice(bt,j+1).map(function(t){var e=A(t),n=ut(t);return wt.default.createElement(Ot,{key:e,Tag:V,record:t,index:n,dataKey:e,children:F,Class:J,Style:Et(Et({},G),mt(e)),onSizeChange:R})})),wt.default.createElement(_t,{children:K,roleId:"footer",Tag:y,onSizeChange:r}),wt.default.createElement("div",{ref:O,style:{width:"vertical"!==f?"0px":"100%",height:"vertical"!==f?"100%":"0px"}}))}var w=wt.default.forwardRef(S);t.VirtualDragList=S,t.default=w,Object.defineProperty(t,"__esModule",{value:!0})});
